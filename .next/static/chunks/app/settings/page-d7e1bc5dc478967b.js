(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{1647:(e,r,t)=>{"use strict";t.d(r,{E:()=>l});var a=t(5155);t(2115);var s=t(3101),n=t(4269);let i=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-emerald-500/15 text-emerald-700 dark:text-emerald-400",warning:"border-transparent bg-amber-500/15 text-amber-700 dark:text-amber-400"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:t}),r),...s})}},3998:(e,r,t)=>{"use strict";t.d(r,{$:()=>o,r:()=>d});var a=t(5155),s=t(2115),n=t(2467),i=t(3101),l=t(4269);let d=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,r)=>{let{className:t,variant:s,size:i,asChild:o=!1,...c}=e,u=o?n.DX:"button";return(0,a.jsx)(u,{className:(0,l.cn)(d({variant:s,size:i,className:t})),ref:r,...c})});o.displayName="Button"},4269:(e,r,t)=>{"use strict";t.d(r,{Yq:()=>l,cn:()=>n,v7:()=>i});var a=t(2821),s=t(5889);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}function i(e){if(0===e)return"0 B";let r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(1))+" "+["B","KB","MB","GB"][r]}function l(e){try{let r=new Date(e);if(isNaN(r.getTime())){let r=e.match(/(\d{4}-\d{2}-\d{2})@(\d{2})h(\d{2})m(\d{2})s/);if(r)return"".concat(r[1]," ").concat(r[2],":").concat(r[3],":").concat(r[4]);return e}return r.toLocaleString("zh-CN")}catch(r){return e}}},5142:(e,r,t)=>{"use strict";t.d(r,{p:()=>i});var a=t(5155),s=t(2115),n=t(4269);let i=s.forwardRef((e,r)=>{let{className:t,type:s,...i}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},6046:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(1847).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},6259:(e,r,t)=>{"use strict";t.d(r,{w:()=>l});var a=t(5155),s=t(2115),n=t(7321),i=t(4269);let l=s.forwardRef((e,r)=>{let{className:t,orientation:s="horizontal",decorative:l=!0,...d}=e;return(0,a.jsx)(n.b,{ref:r,decorative:l,orientation:s,className:(0,i.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",t),...d})});l.displayName=n.b.displayName},6567:(e,r,t)=>{Promise.resolve().then(t.bind(t,7788))},6948:(e,r,t)=>{"use strict";t.d(r,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>l});var a=t(5155),s=t(2115),n=t(4269);let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});i.displayName="Card";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});l.displayName="CardHeader";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});d.displayName="CardTitle";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...s})});o.displayName="CardDescription";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...s})});c.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},7012:(e,r,t)=>{"use strict";t.d(r,{Al:()=>i,gf:()=>n,mu:()=>l});var a=t(7815);let s=async e=>{let r=await fetch(e);if(!r.ok)throw Error("API request failed");let t=await r.json();if(!t.success)throw Error(t.error||"Unknown error");return t.data};function n(e,r){return(0,a.Ay)(e,s,{revalidateOnFocus:!0,dedupingInterval:5e3,keepPreviousData:!0,...r})}async function i(e){let r=await fetch(e,{method:"DELETE"}),t=await r.json();if(!t.success)throw Error(t.error||"Delete failed")}async function l(e,r){let t=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await t.json();if(!a.success)throw Error(a.error||"Update failed");return a.data}},7321:(e,r,t)=>{"use strict";t.d(r,{b:()=>c});var a=t(2115);t(7650);var s=t(2467),n=t(5155),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,s.TL)(`Primitive.${r}`),i=a.forwardRef((e,a)=>{let{asChild:s,...i}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(s?t:r,{...i,ref:a})});return i.displayName=`Primitive.${r}`,{...e,[r]:i}},{}),l="horizontal",d=["horizontal","vertical"],o=a.forwardRef((e,r)=>{var t;let{decorative:a,orientation:s=l,...o}=e,c=(t=s,d.includes(t))?s:l;return(0,n.jsx)(i.div,{"data-orientation":c,...a?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...o,ref:r})});o.displayName="Separator";var c=o},7788:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var a=t(5155),s=t(2115),n=t(7012),i=t(3998),l=t(5142),o=t(1647),d=t(8720);function g(){let{data:e,mutate:r}=(0,n.gf)("/api/config"),[t,g]=(0,s.useState)(""),[u,f]=(0,s.useState)(!1),[m,v]=(0,s.useState)(!1),[h,b]=(0,s.useState)(""),[y,x]=(0,s.useState)(!1),[w,k]=(0,s.useState)(""),[N,S]=(0,s.useState)([]),[C,T]=(0,s.useState)(!1);s.useEffect(()=>{e&&e.dataPath&&g(e.dataPath)},[e]);let P=async e=>{T(!0);try{let r=(e&&e.trim()?e.trim():"/storage").replace(/\\/g,"/"),t=await fetch("/api/config/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataPath:r,listOnly:!0})}),a=await t.json();if(!a.success){d.o.error("Directory read failed",{description:a.error||"Unknown error"});return}k(a.data&&a.data.path?a.data.path:r),S(a.data&&Array.isArray(a.data.dirs)?a.data.dirs:[])}catch(e){d.o.error("Directory read failed",{description:String(e)})}finally{T(!1)}},R=()=>{x(!0),P((t&&t.trim()?t.trim():"/storage").replace(/\\/g,"/"))},A=()=>{let e=(w||"/").replace(/\/+$/,"").split("/");e.pop(),P(e.join("/")||"/")},L=e=>{P(e)},O=()=>{w?(g(w),x(!1),d.o.success("Selected",{description:w})):d.o.error("Invalid directory",{description:"Please choose an accessible folder"})},j=async()=>{f(!0);try{await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataPath:t})}),d.o.success("Saved",{description:"Takes effect after page refresh"}),r(),setTimeout(()=>{confirm("Saved. Refresh page now?")&&window.location.reload()},300)}catch(e){d.o.error("Save failed",{description:String(e)})}finally{f(!1)}},B=async()=>{v(!0),b("");try{let e=t.replace(/\\/g,"/"),r=await fetch("/api/config/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataPath:e})}),a=await r.json();a.success?(b("Path valid"),d.o.success("Path valid",{description:`Characters: ${a.data.characterCount}`})):(b(a.error||"Path invalid"),d.o.error("Path invalid",{description:a.error||"Unknown error"}))}catch(e){b(String(e)),d.o.error("Test failed",{description:String(e)})}finally{v(!1)}};return(0,a.jsxs)("div",{className:"space-y-4 max-w-3xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Settings"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Data Path"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.p,{value:t,onChange:e=>g(e.target.value),placeholder:"/storage/emulated/0/SillyTavern/default-user",className:"font-mono text-sm"}),(0,a.jsx)(i.$,{variant:"outline",onClick:R,className:"shrink-0",children:"Browse"})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tap Browse to pick folders step by step instead of typing full path."})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",onClick:B,disabled:m||!t,children:m?"Testing...":"Test Path"}),(0,a.jsx)(i.$,{onClick:j,disabled:u||!t,children:u?"Saving...":"Save"})]}),h?(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:h}):null,e&&(0,a.jsxs)("div",{className:"text-sm",children:["Current: ",(0,a.jsx)(o.E,{variant:"secondary",children:e.dataPath})]}),y?(0,a.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center p-3",children:(0,a.jsxs)("div",{className:"w-full max-w-xl rounded-lg border bg-background text-foreground shadow-lg",children:[(0,a.jsxs)("div",{className:"border-b p-3 space-y-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Choose Data Folder"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground break-all",children:w||"/storage"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:A,disabled:C,children:"Parent"}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>x(!1),children:"Close"})]})]}),(0,a.jsx)("div",{className:"max-h-[55vh] overflow-auto p-2",children:C?(0,a.jsx)("p",{className:"text-sm text-muted-foreground p-2",children:"Loading..."}):0===N.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground p-2",children:"No subfolders in current path"}):(0,a.jsx)("div",{className:"space-y-1",children:N.slice(0,200).map((e,r)=>(0,a.jsx)("button",{type:"button",className:"w-full text-left rounded-md px-3 py-2 text-sm hover:bg-accent",onClick:()=>L(e.path),children:e.name},e.path||`${e.name}-${r}`))})}),(0,a.jsxs)("div",{className:"border-t p-3 flex justify-end gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",onClick:()=>P(w||"/storage"),disabled:C,children:"Refresh"}),(0,a.jsx)(i.$,{onClick:O,disabled:C||!w,children:"Use Current"})]})]})}):null]})}}},e=>{e.O(0,[545,815,720,441,255,358],()=>e(e.s=6567)),_N_E=e.O()}]);